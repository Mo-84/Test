<!DOCTYPE html>
<html>
<head>
<meta charset="US-ASCII">
<title>Insert title here</title>
</head>
<body>
<script type="text/javascript" src="d3/d3.js"></script>
<script type="text/javascript" src="d3/d3.v3.min.js"></script>
<script type="text/javascript" src="d3/d3.min.js"></script>
<script type="text/javascript">

var width = 600,
height = 500,
data = [{
    value: 500,
    pctFull: 0.20,
    name: "20%"
}, {
    value: 200,
    pctFull: 0.20,
    name: "20%"
}, {
    value: 300,
    pctFull: 0.20,
    name: "20%"
}, {
    value: 1250,
    pctFull: 0.75,
    name: "75%"
}, {
    value: 1600,
    pctFull: 0.25,
    name: "20%"
}, {
    value: 1250,
    pctFull: 0.65,
    name: "65%"
}, {
    value: 1100,
    pctFull: 0.05,
    name: "5%"
}, {
    value: 1050,
    pctFull: 0.35,
    name: "35%"
}, {
    value: 1700,
    pctFull: 0.40,
    name: "40%"
}, ],
kVals = [],
rVals = [],
hVals = [];

//calculate k for each data object as described: http://bl.ocks.org/3422480
function kCalculation() {
var i,
    j,
    t0,
    t1,
    k;

for (i = 0; i < data.length; i += 1) {
    k = data[i].pctFull
    t1 = data[i].pctFull * 2 * Math.PI;
    if (data[i].pctFull > 0 && data[i].pctFull < 1) {
        t1 = Math.pow(12 * k * Math.PI, 1 / 3);
        for (j = 0; j < 10; j += 1) {
            t0 = t1;
            t1 = (Math.sin(t0) - t0 * Math.cos(t0) + 2 * k * Math.PI) / (1 - Math.cos(t0));
        }
        k = (1 - Math.cos(t1/2)) / 2;
    }
    kVals.push(k)
}
}

//calculate r of each item so that area scales to value
function rCalculation() {
var i, r;

for (i = 0; i < data.length; i += 1) {
    rVals.push(Math.sqrt(data[i].value / Math.PI) * 2);
}
}

function drawGraph() {

//create chart
var chart = d3.select('body')
    .append('svg')
    .attr('width', width)
    .attr('height', height);

//create force layout
var force = d3.layout.force()
    .nodes(data)
    .size([width, height])
    //.linkDistance(10)
    .charge(function (d, i) {
        return rVals[i] * (-10);
    })
    .on("tick", tick)
    .start();

var node = chart.selectAll(".node")
    .data(force.nodes())
    .attr("class", "node")
   .enter()
    .append("g")
    .call(force.drag);

// blue circle
node.append("circle")
    .attr("r", function (d, i) {
        return rVals[i];
    })
    .style("fill", "lavender")
//    .style("fill", "#80dabe")
    .style("stroke", "#1a4876");

// clip path for the brown circle
node.append("clipPath")
    .attr('id', function (d) { return "clip" + d.index; })
    .append('rect')
    .attr("x", function (d, i) {  return rVals[i] * (-1); })
    .attr("width", function (d, i) {return rVals[i] * 2; })
    .attr("y", function (d, i) { return rVals[i] - (2 * rVals[i] * kVals[i]); })
    .attr("height", function (d, i) { return 2 * rVals[i] * kVals[i]; });

// brown circle
node.append("circle")
    .attr("clip-path", function (d) {
        return "url(#clip" + d.index + ")"
    })
    .attr("r", function (d, i) {
        return rVals[i];
    })
    .style("fill", "orange")//#dabe80
    .style("stroke", "#1a4876");

function tick() {
    node.attr("transform", function (d) {
        return "translate(" + d.x + "," + d.y + ")";
    });
}

}

kCalculation();
rCalculation();
drawGraph();
</script>
</body>
</html>